<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor de alertas</title>
  <!-- CSS global y del módulo -->
  <link rel="stylesheet" href="../dashboard.css">
  <link rel="stylesheet" href="alertas.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
</head>
<body>
  <div id="layout-header"></div>
  <div class="layout">
    <div id="layout-sidebar"></div>
    <main id="main-content" class="main-content monitor-alertas-root">
      <h1 class="header-section-title">Monitor de alertas</h1>

      <section id="alertas-positivas-container" class="section-container">
        <h2 class="section-title section-title-alertas">Alertas que requieren revisión</h2>
        <div id="lista-alertas-content" class="alertas-list">
          <p id="loading-alertas" class="status-message">Cargando alertas...</p>
          <p id="no-alertas" class="status-message hidden">No hay alertas positivas recientes sin revisar.</p>
          <p id="error-alertas" class="status-message hidden error-message">Error al cargar las alertas.</p>
        </div>
      </section>

      <hr class="section-divider">

      <section id="registro-historico-container" class="section-container">
        <div class="historial-header">
          <h2 class="section-title section-title-historial">Historial de alertas disparadas</h2>
        </div>
        <div class="historial-legend">
          <p>
            <span class="estado-tag positivo">Positivo</span>: El email coincidió con una regla y requiere atención.
            <span class="estado-tag negativo">Negativo</span>: El email fue procesado pero no cumplió las condiciones de ninguna regla positiva.
            <i class="ti ti-info-circle info-icon"></i>: Pasa el mouse sobre este ícono para ver por qué se disparó la alerta.
          </p>
        </div>
        <div class="table-responsive-container">
          <button id="btn-recargar-historial" class="sheet-button"><i class="fas fa-sync"></i> Recargar historial</button>
          <table id="tabla-historial" class="data-table">
            <thead>
              <tr>
                <th class="col-index">#</th>
                <th class="col-timestamp">Fecha y hora</th>
                <th class="col-asunto">Asunto</th>
                <th class="col-condicion">Estado</th>
                <th class="col-revisado">Revisado</th>
                <th class="col-razon">Razón de disparo</th>
                
              </tr>
            </thead>
            <tbody id="cuerpo-tabla-historial">
              <tr id="loading-historial-row">
                <td colspan="6" class="status-message text-center">Cargando historial...</td>
              </tr>
              <tr id="no-historial-row" class="hidden">
                <td colspan="6" class="status-message text-center">No hay historial disponible.</td>
              </tr>
              <tr id="error-historial-row" class="hidden">
                <td colspan="6" class="status-message text-center error-message">Error al cargar el historial.</td>
              </tr>
            </tbody>
          </table>
          <div id="historial-paginado-container"></div>
        </div>
      </section>

      <!-- MODAL de detalle de alerta -->
      <div id="alertaDetalleModal" class="modal-overlay hidden">
        <div class="modal-dialog">
          <header class="modal-header">
            <h3 id="modalDetalleTitulo">Detalle de la Alerta</h3>
            <button id="modalDetalleCerrarBtn" class="modal-close-button" aria-label="Cerrar">
              <i class="fas fa-times"></i>
            </button>
          </header>
          <section id="modalDetalleCuerpo" class="modal-body-content"></section>
          <div id="modalDetalleDatosParseados" class="modal-parsed-data" style="display: none;"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- SCRIPTS solo ES Modules -->
  <script type="module">
    import { loadLayout } from '../shared/layout.js';
    loadLayout();
    import './alertas.js';
  </script>
</body>
</html>
